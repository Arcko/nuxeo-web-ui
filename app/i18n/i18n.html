<script>
  (function () {
    window.I18n = window.I18n || {};

    var language = window.I18n.language || 'en',
        baseUrl = window.I18n.baseUrl || location.origin + location.pathname,
        locales = window.I18n.locales || {};

    /**
     * Translates the given key.
     * Also accepts multiple arguments which will be joined to build the key.
     */
    Polymer.Base.i18n = function (key, defaultValue) {
      if (!locales[language]) {
        var url = baseUrl +  '/i18n/messages.' + language + '.json';
        var xhr = new XMLHttpRequest();
        // XXX synchronous requests are deprecated
        xhr.open('GET', url, false);
        xhr.onerror = function(e) {
         console.error("Failed to load " + url);
        };
        xhr.send();
        locales[language] = JSON.parse(xhr.responseText); // cache this locale.
      }
      var value = locales[language][key] || defaultValue || key;
      var params = Array.prototype.slice.call(arguments, 2);
      for (var i = 0; i < params.length; i++) {
        value = value.replace('{' + i + '}', params[i]);
      }
      return value;
    };
  })();
</script>
